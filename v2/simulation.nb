(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     30960,        909]
NotebookOptionsPosition[     28991,        834]
NotebookOutlinePosition[     29403,        852]
CellTagsIndexPosition[     29360,        849]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["The simulation when the cylinder rolls around on the ground", "Title"],

Cell[CellGroupData[{

Cell["Define equations", "Section"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"eq", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"m2", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"x0", "''"}], "[", "t", "]"}], "+", 
         RowBox[{"R", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"\[Theta]", "''"}], "[", "t", "]"}], 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], "-", 
            RowBox[{
             SuperscriptBox[
              RowBox[{
               RowBox[{"\[Theta]", "'"}], "[", "t", "]"}], "2"], 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}], ")"}]}]}], 
        ")"}]}], "\[Equal]", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"f2", "[", "t", "]"}]}], " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"Fn2", "[", "t", "]"}], " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"m2", " ", "R", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"\[Theta]", "''"}], "[", "t", "]"}]}], " ", 
          RowBox[{"Sin", "[", 
           RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], "-", 
         RowBox[{
          SuperscriptBox[
           RowBox[{
            RowBox[{"\[Theta]", "'"}], "[", "t", "]"}], "2"], 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}], ")"}]}], 
      "\[Equal]", 
      RowBox[{
       RowBox[{
        RowBox[{"f2", "[", "t", "]"}], " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"Fn2", "[", "t", "]"}], " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], "-", 
       RowBox[{"m2", " ", "g"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f2", "[", "t", "]"}], "-", 
       RowBox[{"f1", "[", "t", "]"}]}], "\[Equal]", 
      RowBox[{
       FractionBox[
        RowBox[{
         RowBox[{"x0", "''"}], "[", "t", "]"}], 
        SuperscriptBox["R", "2"]], "i"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f1", "[", "t", "]"}], "+", 
       RowBox[{
        RowBox[{"f2", "[", "t", "]"}], " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], "-", 
       RowBox[{
        RowBox[{"Fn2", "[", "t", "]"}], " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}], "\[Equal]", 
      RowBox[{"m1", " ", 
       RowBox[{
        RowBox[{"x0", "''"}], "[", "t", "]"}]}]}]}], "\[IndentingNewLine]", 
    "}"}]}], "\[IndentingNewLine]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"m2", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox["x0", "\[Prime]\[Prime]",
         MultilineFunction->None], "[", "t", "]"}], "+", 
       RowBox[{"R", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"Sin", "[", 
             RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], " ", 
           SuperscriptBox[
            RowBox[{
             SuperscriptBox["\[Theta]", "\[Prime]",
              MultilineFunction->None], "[", "t", "]"}], "2"]}], "+", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"\[Theta]", "[", "t", "]"}], "]"}], " ", 
           RowBox[{
            SuperscriptBox["\[Theta]", "\[Prime]\[Prime]",
             MultilineFunction->None], "[", "t", "]"}]}]}], ")"}]}]}], 
      ")"}]}], "\[Equal]", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Cos", "[", 
        RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], " ", 
      RowBox[{"f2", "[", "t", "]"}]}], "+", 
     RowBox[{
      RowBox[{"Fn2", "[", "t", "]"}], " ", 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}]}], ",", 
   RowBox[{
    RowBox[{"m2", " ", "R", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Cos", "[", 
          RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}], " ", 
        SuperscriptBox[
         RowBox[{
          SuperscriptBox["\[Theta]", "\[Prime]",
           MultilineFunction->None], "[", "t", "]"}], "2"]}], "-", 
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"\[Theta]", "[", "t", "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["\[Theta]", "\[Prime]\[Prime]",
          MultilineFunction->None], "[", "t", "]"}]}]}], ")"}]}], "\[Equal]", 
    
    RowBox[{
     RowBox[{
      RowBox[{"-", "g"}], " ", "m2"}], "+", 
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{"\[Theta]", "[", "t", "]"}], "]"}], " ", 
      RowBox[{"Fn2", "[", "t", "]"}]}], "+", 
     RowBox[{
      RowBox[{"f2", "[", "t", "]"}], " ", 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"f1", "[", "t", "]"}]}], "+", 
     RowBox[{"f2", "[", "t", "]"}]}], "\[Equal]", 
    FractionBox[
     RowBox[{"i", " ", 
      RowBox[{
       SuperscriptBox["x0", "\[Prime]\[Prime]",
        MultilineFunction->None], "[", "t", "]"}]}], 
     SuperscriptBox["R", "2"]]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"f1", "[", "t", "]"}], "+", 
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{"\[Theta]", "[", "t", "]"}], "]"}], " ", 
      RowBox[{"f2", "[", "t", "]"}]}], "-", 
     RowBox[{
      RowBox[{"Fn2", "[", "t", "]"}], " ", 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Theta]", "[", "t", "]"}], "]"}]}]}], "\[Equal]", 
    RowBox[{"m1", " ", 
     RowBox[{
      SuperscriptBox["x0", "\[Prime]\[Prime]",
       MultilineFunction->None], "[", "t", "]"}]}]}]}], "}"}]], "Output"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define initial conditions", "Section"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"initial", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"x0", "[", "0", "]"}], "\[Equal]", "0"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"x0", "'"}], "[", "0", "]"}], "\[Equal]", "0"}], ",", 
    RowBox[{
     RowBox[{"\[Theta]", "[", "0", "]"}], "\[Equal]", "0"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Theta]", "'"}], "[", "0", "]"}], "\[Equal]", "0"}]}], 
   "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"x0", "[", "0", "]"}], "\[Equal]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox["x0", "\[Prime]",
      MultilineFunction->None], "[", "0", "]"}], "\[Equal]", "0"}], ",", 
   RowBox[{
    RowBox[{"\[Theta]", "[", "0", "]"}], "\[Equal]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox["\[Theta]", "\[Prime]",
      MultilineFunction->None], "[", "0", "]"}], "\[Equal]", "0"}]}], 
  "}"}]], "Output"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define parameters", "Section"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"params", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"m1", "\[Rule]", "28.94"}], ",", 
    RowBox[{"m2", "\[Rule]", "1"}], ",", 
    RowBox[{"g", "\[Rule]", "9.8"}], ",", 
    RowBox[{"i", "\[Rule]", "2.7425"}], ",", 
    RowBox[{"R", "\[Rule]", ".788"}]}], "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"m1", "\[Rule]", "28.94`"}], ",", 
   RowBox[{"m2", "\[Rule]", "1"}], ",", 
   RowBox[{"g", "\[Rule]", "9.8`"}], ",", 
   RowBox[{"i", "\[Rule]", "2.7425`"}], ",", 
   RowBox[{"R", "\[Rule]", "0.788`"}]}], "}"}]], "Output"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Control equation", "Section"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"goal", "[", "t_", "]"}], ":=", 
    RowBox[{"Piecewise", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"t", "<", "5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "+", 
           RowBox[{"5", 
            RowBox[{"(", 
             RowBox[{"t", "-", "5"}], ")"}]}]}], ",", 
          RowBox[{"t", "<", "6"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", 
          RowBox[{"t", "<", "40"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"5", "-", 
           RowBox[{"10", 
            RowBox[{"(", 
             RowBox[{"t", "-", "40"}], ")"}]}]}], ",", 
          RowBox[{"t", "<", "41"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "5"}], ",", 
          RowBox[{"t", "<", "80"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "5"}], "+", 
           RowBox[{"5", 
            RowBox[{"(", 
             RowBox[{"t", "-", "80"}], ")"}]}]}], ",", 
          RowBox[{"t", "<", "81"}]}], "}"}]}], "}"}], ",", "0"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"goal2", "[", "t_", "]"}], ":=", "InterpolatingFunction"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"goal", "[", "t", "]"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "100"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ceq", "=", 
  RowBox[{
   RowBox[{"f2", "[", "t", "]"}], "\[Equal]", 
   RowBox[{
    RowBox[{"10", 
     RowBox[{"\[Theta]", "[", "t", "]"}]}], "+", 
    RowBox[{"1.5", 
     RowBox[{
      RowBox[{"\[Theta]", "'"}], "[", "t", "]"}]}], "+", 
    RowBox[{".1", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"x0", "[", "t", "]"}], "-", 
       RowBox[{"goal", "[", "t", "]"}]}], ")"}]}], "+", 
    RowBox[{".5", " ", 
     RowBox[{
      RowBox[{"x0", "'"}], "[", "t", "]"}]}]}]}]}]}], "Input"],

Cell[BoxData[
 GraphicsBox[{{{{}, {}, 
     {RGBColor[0.368417, 0.506779, 0.709798], AbsoluteThickness[1.6], Opacity[
      1.], LineBox[CompressedData["
1:eJxTTMoPSmViYGBQB2IQrdT/d/E8uYN2DFCwnUNTPjdjvj2Mf7Bi3RKNjPVw
/jGDwnS2jP1w/omeSx5f08/D+Setmne+Sb8P55+aeLvwRfp7ON9rL7vfs/T/
cL7h/6SvYh8Q/B6F+HPKNgwOMH5J0q7SkCMIvsuzgiNbrzDC+Y/e3k2s+MoM
5yv83T7nrxkHnC8yL/WDaDWCz2Ev7KK3H8F/35D3Os6dE87fx6JqdSCcC86P
5Zl0vamCB84/y2vGyRIrAOdf8haaca4Gwb/R+U5t5hwE/wnrche9Owj+n7/i
DRHRgnA+k80XPuVqBJ+j6sLct7MQfOFvHbubbiH4Wu9+flsTKQTnG+hcay2v
RPDNsjaJOM1E8J2eZRldv4Hge6i4H1z4A8H3S1IOyJEQhvMj793OZYxA8ONk
dvw5XY7gp0RN6Z42HcHPmlEglbgdwS+45rNS+zqC33Hs14WI+wg+AOr8ijU=

       "]], LineBox[CompressedData["
1:eJxTTMoPSmViYGCQBmIQXWHJqr9cQcKBAQxEHJz6XQ8s90fw2b7LvGMxlYHz
U/V/8RryKsD5vpqpH8XcVeD8TVdqS09aaMD51kJa61nqdeD89N+T5i6NMIDz
8489N17vawTnd0Wxqf7NMYHzk49XpxlmmMH5B9klA7MjLeB8Q8GGaS9LrOD8
hM+2On45NnD+wnlHZb732sH5m/usbl8KcoDzS3bZBsz1cYTz959a+qkz2gnO
F+l8f/3nTQQ/091yb2aEM5y/Ld7c+tUcBJ+pwnRn1kMEn8f664lfLxF80X9b
bnR9QvBn3Z/y4NI3BF/uYMkLqd8I/sUIeanXSHwAT99ngQ==
       "]], 
      LineBox[{{40.03188775510204, 4.681122448979593}, {40.06210328098255, 
       4.378967190174521}, {40.09555148532526, 4.044485146747405}, {
       40.16244789401068, 3.375521059893174}, {40.29624071138152, 
       2.0375928861847825`}, {40.32968891572423, 1.7031108427576669`}, {
       40.36313712006694, 1.3686287993306223`}, {40.43003352875236, 
       0.6996647124763911}, {40.56382634612321, -0.6382634612320714}, {
       40.59727455046592, -0.9727455046591871}, {
       40.63072275480863, -1.3072275480863027`}, {
       40.697619163494046`, -1.976191634940463}, {
       40.831411980864885`, -3.3141198086488544`}, {
       40.864251183276394`, -3.642511832763944}, {
       40.8970903856879, -3.9709038568790334`}, {
       40.92992958809941, -4.299295880994123}, {
       40.962768790510914`, -4.627687905109141}, {
       40.96811224489796, -4.681122448979593}}], LineBox[CompressedData["
1:eJxTTMoPSmViYGBQAWIQrb/8wVORFhcHBjAQOXCOYaL1jXYE/5fhYT+eHgR/
1bfu2XfmIPiRu0NerFmL4O9wedboex7BFztXLv3uA4J/5cEsP30TVzh/4ue9
jQXlCL7NecmaN18Q/GerSssyitzg/CNuk2Y0NbnD+Yz+tx71N3jA+QyO2xgX
VHrC+R3i330vtXvB+QVRyYe+N3vD+Q8bTVLsp/rA+SKTZ97qXOgL5y8T0Ko8
PtsPzj9YJO+qvtofzp+nsEDGNiQAzt9b84sh4wKCr+jN/kc5PBDO33Jes/vm
FQS/59g/A4XYIDh/cvHLrIQ7CH6NqBy/UmQwnD9p/sSc03MQ/JWarKdKHiD4
ft++9EW+QPC/HHoSbPcBwXdfGbPN4AuCP6v/ioTyDwT/SJOAl8wvBP9tqU+1
6B8EP2MNf+/Xvwg+AGs0pHI=
       "]], LineBox[CompressedData["
1:eJxTTMoPSmViYGDQA2IQPSP4QxGXU4gDAxS8nvVthqQrgi/SZ3RKyB3Bt2vM
+83tieCnl6zSYfVG8HdFKfV/90Pwn/jGHfgQgODzOs76+DIIwU9QFwq5E4bg
s31hlDwYh+D/2DCj70kCkvty9Vk4khH8C89j3vulI/izbm8/eicfwdc7nFv0
owHBD5t087T+YgR/ucHGunnPEXzNpFV+f3ND4fzbnjs3hb5G8C8trtK1Lw5D
uG9zoI3SJwT//46irW154XC+t4Gba81XBP94rH5mdnEEnC+UnLF7bimCH5ex
kPdCOYL/rUh4k0kNgq/S8f3X3xYEv2HT/p4J0xB8K/aADVt3IvhtPJ1ML3Yj
+BcFD4VI7UPwM2RMftYdQvCnG0o4eZxG8L9EP7h86w6C75AoqcZ7H8HvTguq
sH+I4CsVHpFZ8hTBD2xbkZr7DsGf0/1w+/wPCP6LCVJclz4h+Wd2zzqz7wj+
mQVHGTJ/Ivjiy/4Fzf6N4CetNl969i+Cv25Dwff//xF8AK8erRw=
       "]], 
      LineBox[{{5.031887755102041, 0.15943877551020336`}, {5.084312032780538, 
       0.42156016390269}, {5.115358167912872, 0.5767908395643584}, {
       5.146404303045205, 0.7320215152260268}, {5.208496573309872, 
       1.042482866549359}, {5.332681113839206, 1.663405569196028}, {
       5.581050194897874, 2.9052509744893706`}, {5.612096330030207, 
       3.0604816501510346`}, {5.643142465162541, 3.215712325812703}, {
       5.705234735427208, 3.5261736771360397`}, {5.736280870559542, 
       3.681404352797708}, {5.767327005691875, 3.8366350284593764`}, {
       5.829419275956543, 4.147096379782713}, {5.860465411088876, 
       4.3023270554443815`}, {5.89151154622121, 4.45755773110605}, {
       5.922557681353544, 4.612788406767718}, {5.953603816485876, 
       4.768019082429382}, {5.968112244897959, 4.840561224489797}}], 
      LineBox[{{80.03188775510205, -4.840561224489761}, {
       80.12381808847167, -4.380909557641672}, {
       80.24715605746877, -3.7642197126561427`}, {
       80.49383199546298, -2.5308400226850836`}, {
       80.52466648771227, -2.3766675614386656`}, {
       80.55550097996154, -2.2224951001923188`}, {
       80.61716996446009, -1.914150177699554}, {
       80.7405079334572, -1.2974603327140244`}, {
       80.77134242570648, -1.1432878714676065`}, {
       80.80217691795575, -0.9891154102212596}, {
       80.8638459024543, -0.6807704877284948}, {
       80.89468039470357, -0.5265980264821479}, {
       80.92551488695284, -0.37242556523580106`}, {
       80.95634937920212, -0.21825310398938313`}, {
       80.96811224489795, -0.15943877551023888`}}]}, {}}, {{}, {}, {}}}, {}, \
{}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{
   "DefaultBoundaryStyle" -> Automatic, "DefaultMeshStyle" -> 
    AbsolutePointSize[6], "ScalingFunctions" -> None, 
    "CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0, 100}, {-5., 5.}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.05], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output"],

Cell[BoxData[
 RowBox[{
  RowBox[{"f2", "[", "t", "]"}], "\[Equal]", 
  RowBox[{
   RowBox[{"0.1`", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"(", 
        TagBox[GridBox[{
           {"\[Piecewise]", GridBox[{
              {"0", 
               RowBox[{"t", "<", "5"}]},
              {
               RowBox[{"5", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "5"}], "+", "t"}], ")"}]}], 
               RowBox[{"t", "<", "6"}]},
              {"5", 
               RowBox[{"t", "<", "40"}]},
              {
               RowBox[{"5", "-", 
                RowBox[{"10", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", "40"}], "+", "t"}], ")"}]}]}], 
               RowBox[{"t", "<", "41"}]},
              {
               RowBox[{"-", "5"}], 
               RowBox[{"t", "<", "80"}]},
              {
               RowBox[{
                RowBox[{"-", "5"}], "+", 
                RowBox[{"5", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", "80"}], "+", "t"}], ")"}]}]}], 
               RowBox[{"t", "<", "81"}]},
              {"0", 
               TagBox["True",
                "PiecewiseDefault",
                AutoDelete->True]}
             },
             AllowedDimensions->{2, Automatic},
             Editable->True,
             
             GridBoxAlignment->{
              "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, 
               "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
             
             GridBoxItemSize->{
              "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, 
               "Rows" -> {{1.}}, "RowsIndexed" -> {}},
             GridBoxSpacings->{"Columns" -> {
                 Offset[0.27999999999999997`], {
                  Offset[0.84]}, 
                 Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
               "Rows" -> {
                 Offset[0.2], {
                  Offset[0.4]}, 
                 Offset[0.2]}, "RowsIndexed" -> {}},
             Selectable->True]}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          
          GridBoxItemSize->{
           "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{1.}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.35]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}],
         "Piecewise",
         DeleteWithContents->True,
         Editable->False,
         SelectWithContents->True,
         Selectable->False], ")"}]}], "+", 
      RowBox[{"x0", "[", "t", "]"}]}], ")"}]}], "+", 
   RowBox[{"10", " ", 
    RowBox[{"\[Theta]", "[", "t", "]"}]}], "+", 
   RowBox[{"0.5`", " ", 
    RowBox[{
     SuperscriptBox["x0", "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}]}], "+", 
   RowBox[{"1.5`", " ", 
    RowBox[{
     SuperscriptBox["\[Theta]", "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}]}]}]}]], "Output"]
}, Open  ]],

Cell[BoxData[""], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solve ODE", "Section"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"ceq", "=", 
     RowBox[{
      RowBox[{"f2", "[", "t", "]"}], "\[Equal]", 
      RowBox[{
       RowBox[{"5", " ", 
        RowBox[{"\[Theta]", "[", "t", "]"}]}], "+", 
       RowBox[{"0.442", " ", 
        RowBox[{
         RowBox[{"\[Theta]", "'"}], "[", "t", "]"}]}], "+", 
       RowBox[{"0.0884", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"x0", "[", "t", "]"}], "-", 
          RowBox[{"goal", "[", "t", "]"}]}], ")"}]}], "+", 
       RowBox[{"0.648", " ", 
        RowBox[{
         RowBox[{"x0", "'"}], "[", "t", "]"}]}]}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"sol", "=", 
     RowBox[{"NDSolveValue", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"eq", ",", "initial", ",", "ceq"}], "}"}], "/.", "params"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"x0", ",", "\[Theta]"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "120"}], "}"}], ",", 
       RowBox[{"MaxSteps", "\[Rule]", "Infinity"}]}], "]"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"b", ",", "5", ",", "15"}], "}"}]}], "]"}]], "Input"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`b$$ = 5, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`b$$], 5, 15}}, Typeset`size$$ = {274., {197., 20.}}, 
    Typeset`update$$ = 0, Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`b$152585$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, "Variables" :> {$CellContext`b$$ = 5}, 
      "ControllerVariables" :> {
        Hold[$CellContext`b$$, $CellContext`b$152585$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, 
      "Body" :> ($CellContext`ceq = $CellContext`f2[$CellContext`t] == 
         5 $CellContext`\[Theta][$CellContext`t] + 
          0.442 Derivative[1][$CellContext`\[Theta]][$CellContext`t] + 
          0.0884 ($CellContext`x0[$CellContext`t] - \
$CellContext`goal[$CellContext`t]) + 
          0.648 Derivative[
            1][$CellContext`x0][$CellContext`t]; $CellContext`sol = 
        NDSolveValue[
          
          ReplaceAll[{$CellContext`eq, $CellContext`initial, \
$CellContext`ceq}, $CellContext`params], {$CellContext`x0, $CellContext`\
\[Theta]}, {$CellContext`t, 0, 120}, MaxSteps -> Infinity]), 
      "Specifications" :> {{$CellContext`b$$, 5, 15}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{331., {156., 164.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output"],

Cell[BoxData[
 TemplateBox[{
  "NDSolveValue","pdord",
   "\"Some of the functions have zero differential order, so the equations \
will be solved as a system of differential-algebraic equations.\"",2,36,327,
   20755773769435530769,"Local"},
  "MessageTemplate"]], "Message", "MSG"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "@", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"Evaluate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", "t", "]"}], "&"}], "/@", "sol"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "0", ",", "120"}], "}"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<Position x\>\"", ",", "\"\<Angle \[Theta]\>\""}], 
      "}"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 DynamicBox[ToBoxes[
   Plot[
    Evaluate[
     Map[#[$CellContext`t]& , $CellContext`sol]], {$CellContext`t, 0, 120}, 
    PlotRange -> All, PlotLegends -> {"Position x", "Angle \[Theta]"}], 
   StandardForm],
  ImageSizeCache->{584., {126., 134.}}]], "Output"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"plot1", "="}]], "Input",
 EmphasizeSyntaxErrors->True],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"plot2", "=", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"Accumulate", "[", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "100"}], "}"}], ",", 
       RowBox[{"{", "100", "}"}]}], "]"}], "]"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
    RowBox[{"ImagePadding", "\[Rule]", "25"}], ",", 
    RowBox[{"Axes", "\[Rule]", "False"}], ",", 
    RowBox[{"Frame", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"False", ",", "False", ",", "False", ",", "True"}], "}"}]}], 
    ",", 
    RowBox[{"FrameTicks", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"None", ",", "None", ",", "None", ",", "All"}], "}"}]}], ",", 
    RowBox[{"FrameStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Automatic", ",", "Automatic", ",", "Automatic", ",", "Red"}], 
      "}"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 TemplateBox[{
  "Plot","argr",
   "\"\\!\\(\\*RowBox[{\\\"Plot\\\"}]\\) called with 1 argument; \
\\!\\(\\*RowBox[{\\\"2\\\"}]\\) arguments are expected.\"",2,34,325,
   20755773769435530769,"Local"},
  "MessageTemplate"]], "Message", "MSG"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"Accumulate", "[", 
    RowBox[{"RandomReal", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "100"}], "}"}], ",", 
      RowBox[{"{", "100", "}"}]}], "]"}], "]"}], ",", 
   RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
   RowBox[{"ImagePadding", "\[Rule]", "25"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"False", ",", "False", ",", "False", ",", "True"}], "}"}]}], ",", 
   RowBox[{"FrameTicks", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"None", ",", "None", ",", "None", ",", "All"}], "}"}]}], ",", 
   RowBox[{"FrameStyle", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"Automatic", ",", "Automatic", ",", "Automatic", ",", "Red"}], 
     "}"}]}]}], "]"}]], "Output"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Visualize results", "Section"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "\"\<visualization.m\>\""}]}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"man", "=", 
  RowBox[{"Manipulate", "[", 
   RowBox[{
    RowBox[{"getBB8", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"sol", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", "t", "]"}], ",", 
      RowBox[{
       RowBox[{"sol", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", "t", "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "0", ",", "120"}], "}"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`t$$ = 0, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`t$$], 0, 120}}, Typeset`size$$ = {412., {192., 200.}},
     Typeset`update$$ = 0, Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`t$153641$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, "Variables" :> {$CellContext`t$$ = 0}, 
      "ControllerVariables" :> {
        Hold[$CellContext`t$$, $CellContext`t$153641$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> $CellContext`getBB8[
        Part[$CellContext`sol, 1][$CellContext`t$$], 
        Part[$CellContext`sol, 2][$CellContext`t$$]], 
      "Specifications" :> {{$CellContext`t$$, 0, 120}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{469., {244., 252.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output"]
}, Open  ]],

Cell[BoxData["\[IndentingNewLine]"], "Input"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{636, 1041},
WindowMargins->{{642, 642}, {2, Automatic}},
CellContext->Notebook,
TrackCellChangeTimes->False,
Magnification:>1.25 Inherited,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 76, 0, 258, "Title"],
Cell[CellGroupData[{
Cell[681, 26, 35, 0, 81, "Section"],
Cell[CellGroupData[{
Cell[741, 30, 2953, 87, 470, "Input"],
Cell[3697, 119, 3084, 93, 298, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[6830, 218, 44, 0, 81, "Section"],
Cell[CellGroupData[{
Cell[6899, 222, 438, 14, 40, "Input"],
Cell[7340, 238, 486, 15, 40, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[7875, 259, 36, 0, 81, "Section"],
Cell[CellGroupData[{
Cell[7936, 263, 302, 8, 44, "Input"],
Cell[8241, 273, 274, 7, 67, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[8564, 286, 35, 0, 81, "Section"],
Cell[CellGroupData[{
Cell[8624, 290, 2121, 69, 255, "Input"],
Cell[10748, 361, 5875, 114, 275, "Output"],
Cell[16626, 477, 3337, 94, 275, "Output"]
}, Open  ]],
Cell[19978, 574, 26, 0, 38, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20041, 579, 28, 0, 81, "Section"],
Cell[CellGroupData[{
Cell[20094, 583, 1183, 35, 251, "Input"],
Cell[21280, 620, 2093, 43, 340, "Output"],
Cell[23376, 665, 283, 6, 72, "Message"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23696, 676, 494, 14, 102, "Input"],
Cell[24193, 692, 277, 7, 280, "Output"]
}, Open  ]],
Cell[24485, 702, 78, 2, 40, "Input"],
Cell[CellGroupData[{
Cell[24588, 708, 873, 23, 268, "Input"],
Cell[25464, 733, 256, 6, 50, "Message"],
Cell[25723, 741, 822, 21, 229, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26594, 768, 36, 0, 81, "Section"],
Cell[26633, 770, 196, 5, 70, "Input"],
Cell[CellGroupData[{
Cell[26854, 779, 428, 13, 94, "Input"],
Cell[27285, 794, 1618, 33, 516, "Output"]
}, Open  ]],
Cell[28918, 830, 45, 0, 64, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

